{% extends 'base.html' %} {% block content %}
<style>
  .calendar-container {
    max-width: 1400px;
    margin: 2rem auto;
  }

  .page-header {
    margin-bottom: 2rem;
  }

  .page-header h1 {
    font-size: 2rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 0.5rem;
  }

  .page-header p {
    color: #6b7280;
    font-size: 1rem;
  }

  .calendars-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
  }

  @media (max-width: 992px) {
    .calendars-grid {
      grid-template-columns: 1fr;
    }
  }

  .calendar-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    overflow: hidden;
  }

  .calendar-header {
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    border-bottom: 2px solid #f3f4f6;
  }

  .calendar-header.my-bookings {
    background: linear-gradient(135deg, #1e3e62 0%, #2d5a8a 100%);
    color: white;
    border-bottom: none;
  }

  .calendar-header.car-bookings {
    background: linear-gradient(135deg, #059669 0%, #10b981 100%);
    color: white;
    border-bottom: none;
  }

  .calendar-header h2 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
  }

  .calendar-header svg {
    flex-shrink: 0;
  }

  .booking-count {
    margin-left: auto;
    background: rgba(255, 255, 255, 0.2);
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.875rem;
    font-weight: 600;
  }

  .calendar-body {
    padding: 1.5rem;
    max-height: 600px;
    overflow-y: auto;
  }

  .date-group {
    margin-bottom: 2rem;
  }

  .date-group:last-child {
    margin-bottom: 0;
  }

  .date-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #1e3e62;
    font-weight: 600;
    font-size: 0.95rem;
    margin-bottom: 0.75rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #e5e7eb;
  }

  .booking-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .booking-item {
    background: #f9fafb;
    border-radius: 12px;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    transition: all 0.2s ease;
    text-decoration: none;
    color: inherit;
    cursor: pointer;
  }

  .booking-item:hover {
    background: #f3f4f6;
    transform: translateX(4px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .booking-info {
    flex: 1;
  }

  .booking-route {
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 0.25rem;
  }

  .booking-brand {
    color: #6b7280;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .booking-user {
    color: #0891b2;
    font-size: 0.85rem;
    font-weight: 500;
    margin-top: 0.25rem;
  }

  .btn-delete {
    background: #fee2e2;
    color: #dc2626;
    border: none;
    width: 32px;
    height: 32px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    flex-shrink: 0;
    text-decoration: none;
  }

  .btn-delete:hover {
    background: #fecaca;
    transform: scale(1.1);
    color: #dc2626;
  }
  
  .delete-form {
    margin: 0;
    padding: 0;
    display: flex;
  }

  .empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: #9ca3af;
  }

  .empty-state svg {
    margin-bottom: 1rem;
    opacity: 0.5;
  }

  .empty-state p {
    margin: 0;
    font-size: 0.95rem;
  }
</style>

<div class="calendar-container">
  <div class="page-header">
    <h1>My Calendar</h1>
    <p>Manage your bookings and track reservations on your cars</p>
  </div>

  <div class="calendars-grid">
    <!-- My Bookings Calendar -->
    <div class="calendar-card">
      <div class="calendar-header my-bookings">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        <h2>My Bookings</h2>
        <span class="booking-count">{{ my_bookings|length }}</span>
      </div>

      <div class="calendar-body">
        {% if my_bookings %} {% for date, items in my_bookings.items %}
        <div class="date-group">
          <div class="date-header">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            {{ date }}
          </div>
          <div class="booking-list">
            {% for b in items %}
            <a href="{% url 'booking_detail' b.pk %}" class="booking-item">
              <div class="booking-info">
                <div class="booking-brand">{{ b.car.brand }}</div>
                <div class="booking-route">
                  {{ b.car.departure_city.name }}  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                    <polyline points="12 5 19 12 12 19"></polyline>
                  </svg> {{ b.car.arrival_city.name }}
                </div>
              </div>
              <form method="post" action="{% url 'delete_booking' b.pk %}" class="delete-form" onclick="event.stopPropagation();">
                {% csrf_token %}
                <button
                  type="submit"
                  class="btn-delete"
                  title="Delete booking"
                  onclick="return confirm('Are you sure you want to delete this booking?');"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path
                      d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                    ></path>
                  </svg>
                </button>
              </form>
            </a>
            {% endfor %}
          </div>
        </div>
        {% endfor %} {% else %}
        <div class="empty-state">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="64"
            height="64"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <p>No bookings yet.<br />Start by searching for available cars!</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Bookings on My Cars Calendar -->
    <div class="calendar-card">
      <div class="calendar-header car-bookings">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path
            d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"
          ></path>
          <circle cx="7" cy="17" r="2"></circle>
          <path d="M9 17h6"></path>
          <circle cx="17" cy="17" r="2"></circle>
        </svg>
        <h2>Bookings on My Cars</h2>
        <span class="booking-count">{{ on_my_cars|length }}</span>
      </div>

      <div class="calendar-body">
        {% if on_my_cars %} {% for date, items in on_my_cars.items %}
        <div class="date-group">
          <div class="date-header">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            {{ date }}
          </div>
          <div class="booking-list">
            {% for b in items %}
            <a href="{% url 'booking_detail' b.pk %}" class="booking-item">
              <div class="booking-info">
                <div class="booking-brand">{{ b.car.brand }}</div>
                <div class="booking-route">
                  {{ b.car.departure_city.name }} â†’ {{ b.car.arrival_city.name }}
                </div>
                <div class="booking-user">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="12"
                    height="12"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    style="display: inline; vertical-align: middle"
                  >
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  Booked by {{ b.user.username }}
                </div>
              </div>
              <form method="post" action="{% url 'delete_booking' b.pk %}" class="delete-form" onclick="event.stopPropagation();">
                {% csrf_token %}
               {% comment %}  <button
                  type="submit"
                  class="btn-delete"
                  title="Delete booking"
                  onclick="return confirm('Are you sure you want to delete this booking?');"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path
                      d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                    ></path>
                  </svg>
                </button> {% endcomment %}
              </form>
            </a>
            {% endfor %}
          </div>
        </div>
        {% endfor %} {% else %}
        <div class="empty-state">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="64"
            height="64"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"
            ></path>
            <circle cx="7" cy="17" r="2"></circle>
            <path d="M9 17h6"></path>
            <circle cx="17" cy="17" r="2"></circle>
          </svg>
          <p>
            No bookings on your cars yet.<br />Add cars to start receiving
            bookings!
          </p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
